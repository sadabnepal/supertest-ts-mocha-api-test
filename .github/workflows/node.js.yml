name: Run API test and publish report

on:
  push:
    branches: [ main ]

jobs:
  Regression:

    # runs-on: ubuntu-latest
    # permissions:
    #   contents: read
    #   pages: write
    #   id-token: write

    # steps:
    # - name: Checkout git project
    #   uses: actions/checkout@v3

    # - name: Build the Docker image
    #   run: docker build . --file Dockerfile --tag api-node-image:latest
    
    # - name: Run api test in docker
    #   run: docker run --env USER_TOKEN=${{ secrets.GO_RES_USER_TOKEN }} --volume "${pwd}"/report:/app/report/ api-node-image:latest

    # - name: Upload report artifact
    #   uses: actions/upload-artifact@v3
    #   if: always()
    #   with:
    #     name: MochawesomeReport
    #     path: /report

    # - name: Configure GitHub Pages
    #   uses: actions/configure-pages@v4.0.0
    #   if: always()
    # - name: Upload GitHub Pages Report
    #   uses: actions/upload-pages-artifact@v3.0.1
    #   if: always()
    #   with:
    #     path: /report
    #     retention-days: 30 
    # - name: Deploy to GitHub Pages
    #   id: deployment
    #   uses: actions/deploy-pages@v4.0.5    
    #   if: always()
  
    name: Run test
    runs-on: ubuntu-latest
    steps:
    - name: Checkout git project
      uses: actions/checkout@v3

    - name: Install packages
      run: npm ci
    
    - name: Run lint and test
      env :
        GO_RES_USER_TOKEN : ${{ secrets.GO_RES_USER_TOKEN }}
      run: npm run lint&&npm test
    
    - name: Create Report
      uses: phoenix-actions/test-reporting@v8
      id: test-report
      if: success() || failure()
      with:
        name: Generate Result
        path: report/index.json
        reporter: mochawesome-json
    
        
          

    
